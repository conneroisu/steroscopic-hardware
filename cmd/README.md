<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# cmd

```go
import "github.com/conneroisu/steroscopic-hardware/cmd"
```

Package cmd implements the application's web server and HTTP API for stereoscopic image processing.

The cmd package serves as the entry point for the application, providing:

- A web server with a UI for controlling the stereoscopic cameras
- API endpoints for camera configuration and image streaming
- Depth map generation from stereo image pairs
- Graceful shutdown handling

The main packages are:

- Server: HTTP server implementation with proper timeouts
- Routes: API endpoint definitions for camera control and streaming
- Components: Templ\-based UI components for web interface
- Handlers: HTTP handlers for API endpoints

## Index

- [func AddRoutes\(ctx context.Context, mux \*http.ServeMux, logger \*logger.Logger, cancel context.CancelFunc\) error](<#AddRoutes>)
- [func NewServer\(ctx context.Context, logger \*logger.Logger, cancel context.CancelFunc\) \(http.Handler, error\)](<#NewServer>)
- [func Run\(ctx context.Context, onStart func\(\)\) error](<#Run>)


<a name="AddRoutes"></a>
## func [AddRoutes](<https://github.com/conneroisu/steroscopic-hardware/blob/main/cmd/routes.go#L43-L48>)

```go
func AddRoutes(ctx context.Context, mux *http.ServeMux, logger *logger.Logger, cancel context.CancelFunc) error
```

AddRoutes configures all HTTP routes and handlers for the application.

This function registers the following endpoints:

- GET /: Static file server for web assets
- GET /exit: Endpoint to request server shutdown \(returns logs\)
- GET /\{$\}: Main UI page with live camera streams and controls
- POST /update\-params: Update stereoscopic algorithm parameters
- GET /stream/\{left,right,out\}: Live MJPEG streams for both cameras and depth map
- POST /\{left,right\}/configure: Configure camera devices and parameters
- GET /ports: List available serial ports for camera connections

Parameters:

- mux: The HTTP server mux to register routes on
- logger: Application logger for recording events
- params: Stereoscopic algorithm parameters
- leftStream: Stream manager for the left camera
- rightStream: Stream manager for the right camera
- outputStream: Stream manager for the generated depth map
- cancel: CancelFunc to trigger application shutdown

Returns any error encountered during route configuration.

<a name="NewServer"></a>
## func [NewServer](<https://github.com/conneroisu/steroscopic-hardware/blob/main/cmd/root.go#L168-L172>)

```go
func NewServer(ctx context.Context, logger *logger.Logger, cancel context.CancelFunc) (http.Handler, error)
```

NewServer creates a new web\-ui server with all necessary routes and handlers configured.

It sets up the HTTP server with routes for camera streaming, configuration, and depth map generation. The server includes logging middleware that captures request information.

Parameters:

- logger: The application logger for recording events and errors
- params: Stereoscopic algorithm parameters \(block size, max disparity\)
- leftStream: Stream manager for the left camera
- rightStream: Stream manager for the right camera
- outputStream: Stream manager for the generated depth map output
- cancel: CancelFunc to gracefully shut down the application

Returns an http.Handler and any error encountered during setup.

<a name="Run"></a>
## func [Run](<https://github.com/conneroisu/steroscopic-hardware/blob/main/cmd/root.go#L56-L59>)

```go
func Run(ctx context.Context, onStart func()) error
```

Run is the entry point for the application that starts the HTTP server and manages its lifecycle.

Process:

1. Sets up signal handling for graceful shutdown
2. Initializes the logger and camera stream managers
3. Creates and configures the HTTP server with appropriate timeouts
4. Starts the server and monitors for shutdown signals
5. Performs graceful shutdown when terminated

Parameters:

- ctx: Parent context for controlling the application lifecycle
- onStart: Callback function executed after server initialization but

before accepting connections

It returns any unexpected error encountered during server startup or shutdown.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->
